data = leaf_site)
calc.relip.mm(lai_lmer)$lmg
calc.relip.mm(lai_lmer)
# Narea preprocessing
#########################################
# packages necessary
#########################################
library(lme4)
library(car)
library(emmeans)
library(dplyr)
library(RColorBrewer)
library(multcompView)
library(ggplot2)
#########################################
# read in and modify foliar trait dataset (Jen Firn)
#########################################
## load observational data
traits = read.csv('../Data/leaf_plus.csv')
head(traits)
## fiter by overlapping sites
# source('filter_sites.R')
# traits = filter(traits, site_code %in% overlap)
## make sure factors are correctly defined
traits$Ntrt_fac = as.factor(traits$Ntrt_fac)
traits$Ptrt_fac = as.factor(traits$Ptrt_fac)
traits$Ktrt_fac = as.factor(traits$Ktrt_fac)
## add in photosynthetic pathway information
levels(traits$Family) # check Amaranthaceae, Asteraceae, Boraginaceae, Caryophyllaceae, Cyperaceae, Euphorbiaceae,
# Polygonaceae, Poaceae, Scrophulariaceae
# only one!
# C4
traits$photosynthetic_pathway[traits$photosynthetic_pathway == 'NULL'
& traits$Family == 'Cyperaceae' & traits$Taxon == 'FIMBRISTYLIS DICHOTOMA'] <- 'C4'
traits$photosynthetic_pathway[traits$photosynthetic_pathway == 'NULL'] <- 'C3'
## calculate lma (in g m-2) and narea
hist(traits$leaf_area_mm2)
traits$la_m2 = traits$leaf_area_mm2 * (1/1000000)
traits$lma = traits$leaf_dry_mass_g / traits$la_m2
traits$narea = (traits$leaf_pct_N / 100) * (traits$lma)
# hist(traits$lma) # some extremely high values
# hist(traits$narea) # some extremely high values
# hist(traits$SLA)
# hist(traits$la_m2)
# hist(traits$leaf_dry_mass_g) # some very hig values
# hist(subset(traits, leaf_dry_mass_g < 100)$leaf_dry_mass_g)
## some light calculations
traits$lai = -log(traits$Ground_PAR / traits$Ambient_PAR) / 0.86 # from: http://manuals.decagon.com/Manuals/10242_Accupar%20LP80_Web.pdf page 41
# hist(traits$lai)
### calculate par per leaf area to assume par absorbed is reduced in dense canopies
traits$par_per_leaf_area = traits$par * ((1 - exp(-0.5 * traits$lai)) / traits$lai) # from Dong et al. (2007) eqn 2
# hist(traits$par_per_leaf_area)
# hist(traits$Ambient_PAR)
# hist(traits$par)
# hist(((1 - exp(-0.5 * traits$lai)) / traits$lai))
## remove C4 and values without d13c
traits$delta = ((-0.008 - traits$leaf_C13_delta_PDB * 0.001) / (1 + traits$leaf_C13_delta_PDB * 0.001)) * 1000
traits$chi[traits$photosynthetic_pathway == 'C3'] =
(traits$delta[traits$photosynthetic_pathway == 'C3'] * 0.001 - 0.0044) / (0.027 - 0.0044)
traits$chi[traits$photosynthetic_pathway == 'C4'] =
(traits$delta[traits$photosynthetic_pathway == 'C4'] * 0.001 - 0.0044) / ((-0.0057 + 0.03*0.4) - 0.0044)
traits$chi[traits$chi > 1] = 1
traits$chi[traits$chi < 0] = 0
# hist(traits$lma) # some extremely high values
# hist(traits$narea) # some extremely high values
# hist(traits$la_m2)
# hist(traits$leaf_dry_mass_g) #
# hist(traits$chi) # looks good
# traits = subset(traits, chi > 0.2 & chi < 0.95)
traits_group_by_site_for_count = group_by(traits, site_code)
traits_site_count = summarise(traits_group_by_site_for_count, n = n())
subset(traits_site_count, n <=20)
subset(traits_site_count, n <=10)
subset(traits_site_count, n <=30)
write.csv(traits, '../Data/processed/traits.csv')
traits_group_by_site = group_by(traits,
site_code, plot, block, trt, Ntrt, Ptrt, Ktrt)
traits_site = summarise(traits_group_by_site,
narea_mean = mean(narea, na.rm = T),
chi_mean = mean(chi, na.rm = T),
tmp_mean = mean(tmp, na.rm = T),
vpd_mean = mean(vpd, na.rm = T),
z_mean = mean(z, na.rm = T),
lma_mean = mean(lma, na.rm = T),
par_per_leaf_area_mean = mean(par_per_leaf_area, na.rm = T),
par_mean = mean(par, na.rm = T),
lai_mean = mean(lai, na.rm = T),
p_pet_mean = mean(p_pet, na.rm = T),
live_mass_mean = mean(live_mass, na.rm = T))
write.csv(traits_site, '../Data/processed/traits_site.csv')
leaf = read.csv('../Data/processed/traits.csv')
leaf$Ntrt_fac = as.factor(leaf$Ntrt)
leaf$Ptrt_fac = as.factor(leaf$Ptrt)
leaf$Ktrt_fac = as.factor(leaf$Ktrt)
leaf$block_fac = as.factor(leaf$block)
leaf$tmp_scaled = leaf$tmp - 25
# leaf_Nonly = subset(leaf, Ptrt_fac == '0' & Ktrt_fac == '0')
# hist(leaf$chi)
# hist(log(leaf$Narea))
leafchi_lmer = lmer(logit(chi) ~ Ntrt_fac * Ptrt_fac * Ktrt_fac + tmp + log(vpd) + z +
(1|Taxon) + (1|Taxon:site_code) + (1|Taxon:site_code:block_fac),
data = subset(leaf, chi > 0.2 & chi < 0.95))
plot(resid(leafchi_lmer) ~ fitted(leafchi_lmer))
# plot(resid(leafchi_lmer) ~ fitted(leafchi_lmer))
summary(leafchi_lmer)
Anova(leafchi_lmer)
### run analyses
# hist(leaf$narea)
# hist(log(leaf$narea))
leafNarea_lmer = lmer(log(narea) ~ Ntrt_fac * Ptrt_fac * Ktrt_fac + chi + tmp + log(par) +
log(lma) + Nfix + photosynthetic_pathway +
(1|Taxon) + (1|Taxon:site_code) + (1|Taxon:site_code:block_fac),
data = subset(leaf, chi > 0.2 & chi < 0.95))
plot(resid(leafNarea_lmer) ~ fitted(leafNarea_lmer))
# plot(resid(leafNarea_lmer) ~ fitted(leafNarea_lmer))
Anova(leafNarea_lmer)
summary(leafNarea_lmer)
calc.relip.mm(leafNarea_lmer)
### make figure
narea_plot = ggplot(data = leaf,
aes(x = Ntrt_fac, y = log(narea))) +
theme(legend.position = "none",
axis.title.y=element_text(size=rel(4), colour = 'black'),
axis.title.x=element_text(size=rel(4), colour = 'black'),
axis.text.x=element_text(size=rel(3), colour = 'black'),
axis.text.y=element_text(size=rel(3), colour = 'black'),
panel.background = element_rect(fill = 'white', colour = 'black'),
panel.grid.major = element_line(colour = "grey"),
plot.tag = element_text(size = 30)) +
geom_boxplot(outlier.color = NA, fill = 'white', lwd = 5) +
geom_dotplot(binaxis = 'y', binwidth = 0.1, stackdir = 'center',
fill = 'burlywood1', alpha = 0.8) +
scale_x_discrete(labels = c('Ambient', 'Added N')) +
xlab('') +
ylab(expression('Log leaf ' * italic('N')['area'])) +
xlab('Soil N treatment') +
labs(tag = 'A')
relimp_leafn = calc.relip.mm(leafNarea_lmer)$lmg
relimp_leafn_df = NULL
relimp_leafn_df$Factor = c('Soil N', 'Soil P', 'Soil K+µ', 'χ', 'Temperature', 'PAR', 'LMA', 'N fixer', 'C3/C4', 'Soil interactions')
relimp_leafn_df$Importance = as.numeric(as.character(c(relimp_leafn[1:9], sum(relimp_leafn[10:13]))))
sum(relimp_leafn[c(1:3, 10:13)]) # importance of soil
relimp_leafn_df = as.data.frame(relimp_leafn_df)
unexplained = 1 - sum(relimp_leafn_df$Importance)
unexplained_df = data.frame("Unexplained", unexplained)
names(unexplained_df) = c("Factor", "Importance")
relimp_leafn_df = rbind(relimp_leafn_df, unexplained_df)
narea_treemap = ggplot(relimp_leafn_df, aes(area = Importance, label = Factor)) +
theme(plot.tag = element_text(size = 30)) +
geom_treemap(fill = c('burlywood1', 'burlywood2', 'burlywood3',
'blue', 'yellow', 'red', 'grey', 'orange', 'green',
'burlywood4', 'white'), colour = 'black') +
geom_treemap_text(colour = "black", place = "centre",
grow = TRUE) +
labs(tag = 'B')
jpeg(filename = "plots/narea_plot_treemap.jpeg", width = 1700, height = 900, units = 'px')
multiplot(narea_plot, narea_treemap, cols = 2)
dev.off()
sum(relimp_leafn[c(1:3, 10:13)]) # importance of soil
### make figure
narea_plot = ggplot(data = subset(leaf, chi > 0.2 & chi < 0.95),
aes(x = Ntrt_fac, y = log(narea))) +
theme(legend.position = "none",
axis.title.y=element_text(size=rel(4), colour = 'black'),
axis.title.x=element_text(size=rel(4), colour = 'black'),
axis.text.x=element_text(size=rel(3), colour = 'black'),
axis.text.y=element_text(size=rel(3), colour = 'black'),
panel.background = element_rect(fill = 'white', colour = 'black'),
panel.grid.major = element_line(colour = "grey"),
plot.tag = element_text(size = 30)) +
geom_boxplot(outlier.color = NA, fill = 'white', lwd = 5) +
geom_dotplot(binaxis = 'y', binwidth = 0.1, stackdir = 'center',
fill = 'burlywood1', alpha = 0.8) +
scale_x_discrete(labels = c('Ambient', 'Added N')) +
xlab('') +
ylab(expression('Log leaf ' * italic('N')['area'])) +
xlab('Soil N treatment') +
labs(tag = 'A')
jpeg(filename = "plots/narea_plot_treemap.jpeg", width = 1700, height = 900, units = 'px')
multiplot(narea_plot, narea_treemap, cols = 2)
dev.off()
#####################################################################
## Narea predictions
#####################################################################
gas_exchange_pred_c3 = calc_optimal_vcmax_knownchi(tg_c = leaf$tmp,
paro = leaf$par,
cao = 400,
vpdo = leaf$vpd,
z = leaf$z,
chi = leaf$chi,
q0 = 0.1)
gas_exchange_pred_c3
gas_exchange_pred_c4 = C4model_knownchi(tg_c = leaf$tmp,
paro = leaf$par,
cao = 400,
vpdo = leaf$vpd,
z = leaf$z,
chi = leaf$chi,
q0 = 0.1)
leaf$vcmax25[leaf$photosynthetic_pathway == 'C3'] = gas_exchange_pred_c3$vcmax[leaf$photosynthetic_pathway == 'C3'] /
calc_vcmax_tresp_mult(gas_exchange_pred_c3$tg_c[leaf$photosynthetic_pathway == 'C3'],
gas_exchange_pred_c3$tg_c[leaf$photosynthetic_pathway == 'C3'], 25)
leaf$jmax25[leaf$photosynthetic_pathway == 'C3'] = gas_exchange_pred_c3$jmax[leaf$photosynthetic_pathway == 'C3'] /
calc_jmax_tresp_mult(gas_exchange_pred_c3$tg_c[leaf$photosynthetic_pathway == 'C3'],
gas_exchange_pred_c3$tg_c[leaf$photosynthetic_pathway == 'C3'], 25)
leaf$vpmax25[leaf$photosynthetic_pathway == 'C3'] = 0
leaf$vcmax25[leaf$photosynthetic_pathway == 'C4'] = gas_exchange_pred_c4$vcmax[leaf$photosynthetic_pathway == 'C4'] /
calc_vcmax_tresp_mult(gas_exchange_pred_c4$tg_c[leaf$photosynthetic_pathway == 'C4'],
gas_exchange_pred_c4$tg_c[leaf$photosynthetic_pathway == 'C4'], 25)
leaf$jmax25[leaf$photosynthetic_pathway == 'C4'] = gas_exchange_pred_c4$jmax[leaf$photosynthetic_pathway == 'C4'] /
calc_jmax_tresp_mult(gas_exchange_pred_c4$tg_c[leaf$photosynthetic_pathway == 'C4'],
gas_exchange_pred_c4$tg_c[leaf$photosynthetic_pathway == 'C4'], 25)
leaf$vpmax25[leaf$photosynthetic_pathway == 'C4'] = gas_exchange_pred_c4$vpmax[leaf$photosynthetic_pathway == 'C4'] /
calc_vcmax_tresp_mult(gas_exchange_pred_c4$tg_c[leaf$photosynthetic_pathway == 'C4'],
gas_exchange_pred_c4$tg_c[leaf$photosynthetic_pathway == 'C4'], 25)
leaf$nrubisco = fvcmax25_nrubisco(leaf$vcmax25)
leaf$nbioe = fjmax25_nbioe(leaf$jmax25)
leaf$npep = fvcmax25_nrubisco(leaf$vpmax25)
leaf$nstructure = flma_nstructure(leaf$lma)
leaf$nall = leaf$nrubisco + leaf$nbioe + leaf$nstructure + leaf$npep
leaf$nphoto = leaf$nrubisco + leaf$nbioe + leaf$npep
leaf$nrubisco_frac = leaf$nrubisco / leaf$nall
leaf$nphoto_frac = leaf$nphoto / leaf$nall
npred_soil_lmer = lmer(log(narea) ~ lognphoto + lognstructure +
Ntrt_fac * Ptrt_fac * Ktrt_fac +
Nfix + photosynthetic_pathway +
(1|Taxon) + (1|Taxon:site_code) + (1|Taxon:site_code:block_fac),
data = subset(leaf, chi > 0.2 & chi < 0.95))
leaf$lognphoto = log(leaf$nphoto)
leaf$lognstructure = log(leaf$nstructure)
npred_soil_lmer = lmer(log(narea) ~ lognphoto + lognstructure +
Ntrt_fac * Ptrt_fac * Ktrt_fac +
Nfix + photosynthetic_pathway +
(1|Taxon) + (1|Taxon:site_code) + (1|Taxon:site_code:block_fac),
data = subset(leaf, chi > 0.2 & chi < 0.95))
plot(resid(npred_soil_lmer) ~ fitted(npred_soil_lmer))
Anova(npred_soil_lmer)
summary(npred_soil_lmer)
calc.relip.mm(npred_soil_lmer)
leaf_site = read.csv('../Data/processed/traits_site.csv')
leaf_site$Ntrt_fac = as.factor(leaf_site$Ntrt)
leaf_site$Ptrt_fac = as.factor(leaf_site$Ptrt)
leaf_site$Ktrt_fac = as.factor(leaf_site$Ktrt)
leaf_site$block_fac = as.factor(leaf_site$block)
# hist(leaf_site_Nonly$lai_mean)
# hist(log(leaf_site_Nonly$lai_mean))
lai_lmer = lmer(log(lai_mean) ~ Ntrt_fac * Ptrt_fac * Ktrt_fac +
(1|site_code) + (1|site_code:block),
data = leaf_site)
# plot(resid(lai_lmer) ~ fitted(lai_lmer))
Anova(lai_lmer)
summary(lai_lmer)
cld(emmeans(lai_lmer, ~Ntrt_fac))
(exp(summary(emmeans(lai_lmer, ~Ntrt_fac))[2,2]) - exp(summary(emmeans(lai_lmer, ~Ntrt_fac))[1,2])) /
abs(exp(summary(emmeans(lai_lmer, ~Ntrt_fac))[1,2]))
cld(emmeans(lai_lmer, ~Ntrt_fac*Ptrt_fac))
calc.relip.mm(lai_lmer)
leaf_site$NPgroup[leaf_site$Ntrt_fac == '0' & leaf_site$Ptrt_fac == '0'] = 'Control'
leaf_site$NPgroup[leaf_site$Ntrt_fac == '0' & leaf_site$Ptrt_fac == '0'] = '-N, -P'
leaf_site$NPgroup[leaf_site$Ntrt_fac == '0' & leaf_site$Ptrt_fac == '0'] = '-N, -P'
leaf_site$NPgroup[leaf_site$Ntrt_fac == '1' & leaf_site$Ptrt_fac == '0'] = '+N, -P'
leaf_site$NPgroup[leaf_site$Ntrt_fac == '0' & leaf_site$Ptrt_fac == '1'] = '-N, +P'
leaf_site$NPgroup[leaf_site$Ntrt_fac == '1' & leaf_site$Ptrt_fac == '1'] = '+N, +P'
leaf_site$NPgroup
lai_plot = ggplot(data = leaf_site,
aes(x = NPgroup, y = log(lai_mean))) +
theme(legend.position = "none",
axis.title.y=element_text(size=rel(2.5), colour = 'black'),
axis.title.x=element_text(size=rel(2.5), colour = 'black'),
axis.text.x=element_text(size=rel(2), colour = 'black'),
axis.text.y=element_text(size=rel(2), colour = 'black'),
panel.background = element_rect(fill = 'white', colour = 'black'),
panel.grid.major = element_line(colour = "grey")) +
geom_boxplot(outlier.color = NA, fill = 'white') +
geom_dotplot(binaxis = 'y', binwidth = 0.1, fill = 'burlywood1', stackdir = 'center', alpha = 0.5) +
# scale_x_discrete(labels = c('Ambient', 'Added N')) +
xlab('N x P treatment') +
ylab(expression('Log LAI (m' ^ '2' *' m' ^'-2' * ')'))
lai_plot
cld(emmeans(lai_lmer, ~Ntrt_fac*Ptrt_fac))
jpeg(filename = "plots/lai_plot.jpeg", width = 500, height = 550, units = 'px')
plot(lai_plot)
dev.off()
lai_plot = ggplot(data = leaf_site,
aes(x = NPgroup, y = log(lai_mean))) +
theme(legend.position = "none",
axis.title.y=element_text(size=rel(2.5), colour = 'black'),
axis.title.x=element_text(size=rel(2.5), colour = 'black'),
axis.text.x=element_text(size=rel(2), colour = 'black'),
axis.text.y=element_text(size=rel(2), colour = 'black'),
panel.background = element_rect(fill = 'white', colour = 'black'),
panel.grid.major = element_line(colour = "grey")) +
geom_boxplot(outlier.color = NA, fill = 'white') +
geom_dotplot(binaxis = 'y', binwidth = 0.1, fill = NPgroup, stackdir = 'center', alpha = 0.5) +
# scale_x_discrete(labels = c('Ambient', 'Added N')) +
xlab('N x P treatment') +
ylab(expression('Log LAI (m' ^ '2' *' m' ^'-2' * ')'))
lai_plot = ggplot(data = leaf_site,
aes(x = NPgroup, y = log(lai_mean))) +
theme(legend.position = "none",
axis.title.y=element_text(size=rel(2.5), colour = 'black'),
axis.title.x=element_text(size=rel(2.5), colour = 'black'),
axis.text.x=element_text(size=rel(2), colour = 'black'),
axis.text.y=element_text(size=rel(2), colour = 'black'),
panel.background = element_rect(fill = 'white', colour = 'black'),
panel.grid.major = element_line(colour = "grey")) +
geom_boxplot(outlier.color = NA, fill = 'white') +
geom_dotplot(aes(fill = NPgroup), binaxis = 'y', binwidth = 0.1, stackdir = 'center', alpha = 0.5) +
# scale_x_discrete(labels = c('Ambient', 'Added N')) +
xlab('N x P treatment') +
ylab(expression('Log LAI (m' ^ '2' *' m' ^'-2' * ')'))
lai_plot
lai_plot = ggplot(data = leaf_site,
aes(x = NPgroup, y = log(lai_mean))) +
theme(legend.position = "none",
axis.title.y=element_text(size=rel(2.5), colour = 'black'),
axis.title.x=element_text(size=rel(2.5), colour = 'black'),
axis.text.x=element_text(size=rel(2), colour = 'black'),
axis.text.y=element_text(size=rel(2), colour = 'black'),
panel.background = element_rect(fill = 'white', colour = 'black'),
panel.grid.major = element_line(colour = "grey")) +
geom_boxplot(outlier.color = NA, fill = 'white') +
geom_dotplot(aes(fill = NPgroup), binaxis = 'y', binwidth = 0.1, stackdir = 'center', alpha = 0.5) +
scale_fill_manual(values = c('grey', 'blue', 'red', 'purple'))
lai_plot = ggplot(data = leaf_site,
aes(x = NPgroup, y = log(lai_mean))) +
theme(legend.position = "none",
axis.title.y=element_text(size=rel(2.5), colour = 'black'),
axis.title.x=element_text(size=rel(2.5), colour = 'black'),
axis.text.x=element_text(size=rel(2), colour = 'black'),
axis.text.y=element_text(size=rel(2), colour = 'black'),
panel.background = element_rect(fill = 'white', colour = 'black'),
panel.grid.major = element_line(colour = "grey")) +
geom_boxplot(outlier.color = NA, fill = 'white') +
geom_dotplot(aes(fill = NPgroup), binaxis = 'y', binwidth = 0.1, stackdir = 'center', alpha = 0.5) +
scale_fill_manual(values = c('grey', 'blue', 'red', 'purple')) +
# scale_x_discrete(labels = c('Ambient', 'Added N')) +
xlab('N x P treatment') +
ylab(expression('Log LAI (m' ^ '2' *' m' ^'-2' * ')'))
lai_plot = ggplot(data = leaf_site,
aes(x = NPgroup, y = log(lai_mean))) +
theme(legend.position = "none",
axis.title.y=element_text(size=rel(2.5), colour = 'black'),
axis.title.x=element_text(size=rel(2.5), colour = 'black'),
axis.text.x=element_text(size=rel(2), colour = 'black'),
axis.text.y=element_text(size=rel(2), colour = 'black'),
panel.background = element_rect(fill = 'white', colour = 'black'),
panel.grid.major = element_line(colour = "grey")) +
geom_boxplot(outlier.color = NA, fill = 'white') +
geom_dotplot(aes(fill = NPgroup), binaxis = 'y', binwidth = 0.1, stackdir = 'center', alpha = 0.5) +
scale_fill_manual(values = c('grey', 'blue', 'red', 'purple')) +
# scale_x_discrete(labels = c('Ambient', 'Added N')) +
xlab('N x P treatment') +
ylab(expression('Log LAI (m' ^ '2' *' m' ^'-2' * ')'))
lai_plot
jpeg(filename = "plots/lai_plot.jpeg", width = 500, height = 550, units = 'px')
plot(lai_plot)
dev.off()
### calculate deltas (per block per site)
leaf_site_N_group_by = group_by(leaf,
site_code, Ntrt_fac, Ptrt_fac)
leaf_site_N = summarise(leaf_site_N_group_by,
n = n(),
narea_mean = mean(narea, na.rm = T),
lai_mean = mean(lai, na.rm = T),
chi_mean = mean(chi, na.rm = T),
live_mass_mean = mean(live_mass, na.rm = T))
leaf_site_lowN_lowP = subset(leaf_site_N, Ntrt_fac == '0' & Ptrt_fac == '0')
leaf_site_lowN_lowP = subset(leaf_site_N, Ntrt_fac == '0' & Ptrt_fac == '0')
leaf_site_highN_lowP = subset(leaf_site_N, Ntrt_fac == '1' & Ptrt_fac == '0')
leaf_site_lowN_highP = subset(leaf_site_N, Ntrt_fac == '0' & Ptrt_fac == '1')
leaf_site_highN_highP = subset(leaf_site_N, Ntrt_fac == '1' & Ptrt_fac == '1')
nrow(leaf_site_lowN_lowP)
nrow(leaf_site_highN_lowP)
nrow(leaf_site_lowN_highP)
nrow(leaf_site_highN_highP)
leaf_site_trt = right_join(leaf_site_lowN_lowP, leaf_site_highN_lowP,
leaf_site_lowN_highP, leaf_site_highN_highP,
by = c('site_code'))
leaf_site_lowN_lowP
leaf_site_highN_lowP
leaf_site_lowN_highP
leaf_site_highN_highP
leaf_site_lowN_lowP
leaf_site_highN_lowP
leaf_site_trt = right_join(leaf_site_lowN_lowP, leaf_site_highN_lowP,
leaf_site_lowN_highP, leaf_site_highN_highP,
by = c('site_code'))
leaf_site_trt = left_join(leaf_site_lowN_lowP, leaf_site_highN_lowP,
leaf_site_lowN_highP, leaf_site_highN_highP,
by = c('site_code'))
nrow(leaf_site_lowN_lowP)
nrow(leaf_site_highN_lowP)
nrow(leaf_site_lowN_highP)
nrow(leaf_site_highN_highP)
leaf_site_lowN_lowP$site_code
leaf_site_lowN_highP$site_code
leaf_site_highN_highP$site_code
leaf_site_trt = left_join(leaf_site_lowN_lowP, leaf_site_highN_lowP,
by = c('site_code'))
leaf_site_trt = left_join(leaf_site_lowN_lowP, leaf_site_highN_lowP,
leaf_site_lowN_highP,
by = c('site_code'))
leaf_site_highN_highP = subset(leaf_site_N, Ntrt_fac == '1' & Ptrt_fac == '1')
nrow(leaf_site_highN_highP)
leaf_site_trt = left_join(leaf_site_lowN_lowP, leaf_site_highN_lowP,
leaf_site_lowN_highP, leaf_site_highN_highP,
by = c('site_code'))
leaf_site_trt1 = left_join(leaf_site_lowN_lowP, leaf_site_highN_lowP,
by = c('site_code'))
leaf_site_trt2 = left_join(leaf_site_trt1, leaf_site_lowN_highP,
by = c('site_code'))
leaf_site_trt = left_join(leaf_site_trt2, leaf_site_highN_highP,
by = c('site_code'))
nrow(leaf_site_trt)
leaf_site_trt
colnames(leaf_site_trt)
leaf_site_trt$delta_narea_lowP = ((leaf_site_trt$narea_mean.y -
leaf_site_trt$narea_mean.x) / leaf_site_trt$narea_mean.x) * 100
leaf_site_trt$delta_lai_lowP = ((leaf_site_trt$lai_mean.y -
leaf_site_trt$lai_mean.x) / leaf_site_trt$lai_mean.x) * 100
leaf_site_trt$delta_live_mass_lowP = ((leaf_site_trt$live_mass_mean.y -
leaf_site_trt$live_mass_mean.x) / leaf_site_trt$live_mass_mean.x) * 100
leaf_site_trt$delta_chi_lowP = ((leaf_site_trt$chi_mean.y -
leaf_site_trt$chi_mean.x) / leaf_site_trt$chi_mean.x) * 100
leaf_site_trt$delta_narea_highP = ((leaf_site_trt$narea_mean.y.y -
leaf_site_trt$narea_mean.x.x) / leaf_site_trt$narea_mean.x.x) * 100
leaf_site_trt$delta_lai_highP = ((leaf_site_trt$lai_mean.y.y -
leaf_site_trt$lai_mean.x.x) / leaf_site_trt$lai_mean.x.x) * 100
leaf_site_trt$delta_live_mass_highP = ((leaf_site_trt$live_mass_mean.y.y -
leaf_site_trt$live_mass_mean.x.x) / leaf_site_trt$live_mass_mean.x.x) * 100
leaf_site_trt$delta_chi_highP = ((leaf_site_trt$chi_mean.y.y -
leaf_site_trt$chi_mean.x.x) / leaf_site_trt$chi_mean.x.x) * 100
rep(leaf_site_trt, 2)
rep(leaf_site_trt$site_code, 2)
cbind(rep(leaf_site_trt$site_code, 2),
c(rep('low P', 27), rep('high P', 27)),
c(leaf_site_trt$delta_narea_lowP, leaf_site_trt$delta_narea_highP))
as.data.frame(rep(leaf_site_trt$site_code, 2),
c(rep('low P', 27), rep('high P', 27)),
c(leaf_site_trt$delta_narea_lowP, leaf_site_trt$delta_narea_highP),
c(leaf_site_trt$delta_lai_lowP, leaf_site_trt$delta_narea_highP))
as.data.frame(cbind(rep(leaf_site_trt$site_code, 2),
c(rep('low P', 27), rep('high P', 27)),
c(leaf_site_trt$delta_narea_lowP, leaf_site_trt$delta_narea_highP),
c(leaf_site_trt$delta_lai_lowP, leaf_site_trt$delta_narea_highP)))
as.data.frame(cbind(rep(leaf_site_trt$site_code, 2),
c(rep('low P', 27), rep('high P', 27)),
c(leaf_site_trt$delta_narea_lowP, leaf_site_trt$delta_narea_highP),
c(leaf_site_trt$delta_lai_lowP, leaf_site_trt$delta_lai_highP)),
colnames = c('site_code', 'Ptrt_fac', 'delta_narea', 'delta_lai'))
delta_df = as.data.frame(cbind(rep(leaf_site_trt$site_code, 2),
c(rep('low P', 27), rep('high P', 27)),
c(leaf_site_trt$delta_narea_lowP, leaf_site_trt$delta_narea_highP),
c(leaf_site_trt$delta_lai_lowP, leaf_site_trt$delta_lai_highP)))
colnames(delta_df) = c('site_code', 'Ptrt_fac', 'delta_narea', 'delta_lai')
delta_df
class(delta_df$delta_lai)
delta_df$delta_lai = as.numeric(as.character(delta_df$delta_lai))
delta_df$delta_lai
delta_df$delta_narea = as.numeric(as.character(delta_df$delta_narea))
delta_df$delta_narea
### model response
delta_lai_P_lm = lm(delta_narea ~ delta_lai * Ptrt_fac,
data = delta_df) # extreme outlier
plot(resid(delta_lai_lm) ~ fitted(delta_lai_lm))
delta_lai_P_lm
summary(delta_lai_lm)
plot(resid(delta_lai_P_lm) ~ fitted(delta_lai_P_lm))
resid(delta_lai_P_lm)
delta_df
rep(leaf_site_trt$site_code, 2)
delta_df$site_code = rep(leaf_site_trt$site_code, 2)
delta_df$site_code
### model response
delta_lai_P_lmer = lm(delta_narea ~ delta_lai * Ptrt_fac + (1|site_code),
data = subset(delta_df, site_code != 'burrawan.au')) # extreme outlier
### model response
delta_lai_P_lmer = lmer(delta_narea ~ delta_lai * Ptrt_fac + (1|site_code),
data = subset(delta_df, site_code != 'burrawan.au')) # extreme outlier
plot(resid(delta_lai_P_lmer) ~ fitted(delta_lai_P_lmer))
Anova(delta_lai_lm)
Anova(delta_lai_P_lmer)
summary(delta_lai_P_lmer)
resid(delta_lai_P_lmer)
delta_df
### model response
delta_lai_P_lmer = lmer(delta_narea ~ delta_lai * Ptrt_fac + (1|site_code),
data = subset(delta_df,
site_code != 'burrawan.au' & site_code != 'sage.us')) # extreme outliers
plot(resid(delta_lai_P_lmer) ~ fitted(delta_lai_P_lmer))
Anova(delta_lai_P_lmer)
resid(delta_lai_P_lmer)
delta_lai_P_lmer
delta_df
### model response
delta_lai_P_lmer = lmer(delta_narea ~ delta_lai * Ptrt_fac + (1|site_code),
data = subset(delta_df,
site_code != 'burrawan.au' &
site_code != 'sage.us' &
site_code != 'mtca.au')) # extreme outliers
plot(resid(delta_lai_P_lmer) ~ fitted(delta_lai_P_lmer))
Anova(delta_lai_P_lmer)
summary(delta_lai_P_lmer)
### model response
delta_lai_P_lmer = lmer(log(delta_narea) ~ log(delta_lai) * Ptrt_fac + (1|site_code),
data = subset(delta_df,
site_code != 'burrawan.au' &
site_code != 'sage.us' &
site_code != 'mtca.au')) # extreme outliers
plot(resid(delta_lai_P_lmer) ~ fitted(delta_lai_P_lmer))
Anova(delta_lai_P_lmer)
